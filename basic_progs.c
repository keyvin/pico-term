#include "basic_progs.h"
#include "hardware/clocks.h"
#include "main.h"

char mandel[6000] = {" \
REM COLORS\n \
1 DATA 2,4,1,7,63,70,71,102,193,221,64,255,255,255,255,255,0\n \
2 DIM CD(17)\n \
4 FOR J = 0 TO 16: READ CD(J): NEXT J\n \
5 PRINT \"Mandelbrot Visualizer\"\n   \
6 PRINT \"Pick Detail Level\"\n    \
10 PX=0:PY=0\n \
11 CL=0\n \
12 print \"(H)igh, (M)edium, (L)ow (enter):\";:input C$\n \
13 if left$(C$,1)=\"L\" then goto 1000\n \
14 if left$(C$,1)=\"M\" then goto 1050\n \
15 if left$(C$,1)=\"H\" then goto 1100\n \
16 PRINT \"First letter, then enter. Choice not recognized\"\n \
50 OUT 19,255\n \
51 FOR Y=YL TO YH\n \
60 FOR X=XL TO XH\n \
70 CA=X*XTC\n \
80 CB= Y*YTC\n \
90 A=CA\n \
100 B=CB\n \
110 FOR I=0 TO 15\n \
120 T=A*A-B*B+CA\n \
130 B=2*A*B+CB\n \
140 A=T\n \
150 IF (A*A+B*B)>4 THEN GOTO 189\n \
160 NEXT I\n \
170 PRINT \" \";\n \
174 CL=0\n \
175 GOSUB 400\n \
180 GOTO 205\n \
189 CL=I\n \
190 IF I>9 THEN I=I+7\n \
200 PRINT CHR$(48+I);\n \
202 GOSUB 400\n \
205 PX=PX+1\n \
210 NEXT X\n \
211 PX=0\n \
220 PRINT\n \
221 PY=PY+1\n \
230 NEXT Y\n \
235 INPUT X\n \
236 out 19,0\n \
240 END\n \
\n \
REM draw on pico\n \
400 on detail goto 405, 465,550\n \
405 AX=PX*4\n \
410 AY=PY*8\n \
420 FOR AS = 0 TO 7\n \
425 OUT 18,2:OUT 17,AY+AS:OUT 18,1\n \
430 IF AX> 255 THEN OUT 17,AX-255: OUT 17,1:GOTO 450\n \
440 OUT 17,AX:OUT 18,0\n \
450 FOR AJ = 0 TO 3 : OUT 17,CD(CL): NEXT AJ\n \
455 NEXT AS\n \
456 goto 900\n \
\n \
465 AX=PX*2\n \
470 AY=PY*2\n \
480 FOR AS = 0 TO 1\n \
490 OUT 18,2:OUT 17,AY+AS:OUT 18,1\n \
500 IF AX> 255 THEN OUT 17,AX-255: OUT 17,1:GOTO 510\n \
510 OUT 17,AX:OUT 18,0\n \
520 OUT 17,CD(CL): OUT 17,CD(CL)\n \
530 NEXT AS\n \
540 goto 900\n \
\n \
550 AX=PX\n \
560 AY=PY\n \
580 OUT 18,2:OUT 17,AY+AS:OUT 18,1\n \
590 IF AX> 255 THEN OUT 17,AX-255: OUT 17,1:GOTO 610\n \
600 OUT 17,AX:OUT 18,0\n \
610 OUT 17,CD(CL)\n \
630 goto 900\n \
900 RETURN\n \
\n \
1000 DETAIL=1:XL=-39:XH=39:YL=-12:YH=12\n \
1001 XTC = 0.0458:YTC = .0833\n \
1002 goto 50\n \
\n \
1050 DETAIL=2:XL=-78:XH=78:YL=-48:YH=48\n \
1051 XTC = 0.0229:YTC=.020825\n \
1052 goto 50\n \
\n \
1100 DETAIL=3:XL=-156:XH=156:YL=-96:YH=96\n \
1101 XTC = 0.01145:YTC=.01041\n \
1102 goto 50\n \
"};

char sst[30000] = {
"new\n \
clear 2048\n \
30 REM\n \
40 REM ****        **** STAR TREK ****        ****\n \
50 REM **** SIMULATION OF A MISSION OF THE STARSHIP ENTERPRISE,\n \
60 REM **** AS SEEN ON THE STAR TREK TV SHOW.\n \
70 REM **** ORIGIONAL PROGRAM BY MIKE MAYFIELD, MODIFIED VERSION\n \
80 REM **** PUBLISHED IN DEC'S \"101 BASIC GAMES\", BY DAVE AHL.\n \
90 REM **** MODIFICATIONS TO THE LATTER (PLUS DEBUGGING) BY BOB\n \
100 REM *** LEEDOM - APRIL & DECEMBER 1974,\n \
110 REM *** WITH A LITTLE HELP FROM HIS FRIENDS . . .\n \
120 REM *** COMMENTS, EPITHETS, AND SUGGESTIONS SOLICITED --\n \
130 REM *** SEND TO:  R. C. LEEDOM\n \
140 REM ***           WESTINGHOUSE DEFENSE & ELECTRONICS SYSTEMS CNTR.\n \
150 REM ***           BOX 746, M.S. 338\n \
160 REM ***           BALTIMORE, MD  21203\n \
170 REM ***\n \
180 REM *** CONVERTED TO MICROSOFT 8 K BASIC 3/16/78 BY JOHN GORDERS\n \
190 REM *** LINE NUMBERS FROM VERSION STREK7 OF 1/12/75 PRESERVED AS\n \
200 REM *** MUCH AS POSSIBLE WHILE USING MULTIPLE STATEMENTS PER LINE\n \
205 REM *** SOME LINES ARE LONGER THAN 72 CHARACTERS; THIS WAS DONE\n \
210 REM *** BY USING \"?\" INSTEAD OF \"PRINT\" WHEN ENTERING LINES\n \
215 REM ***\n \
220 PRINT:PRINT:PRINT:PRINT:PRINT:PRINT:PRINT:PRINT:PRINT:PRINT:PRINT\n \
221 PRINT\"                                    ,------*------,\"\n \
222 PRINT\"                    ,-------------   '---  ------'\"\n \
223 PRINT\"                     '-------- --'      / /\"\n \
224 PRINT\"                         ,---' '-------/ /--,\"\n \
225 PRINT\"                          '----------------'\":PRINT\n \
226 PRINT\"                    THE USS ENTERPRISE --- NCC-1701\"\n \
227 PRINT:PRINT:PRINT:PRINT:PRINT\n \
260 REM CLEAR 600\n \
270 Z$=\"                         \"\n \
330 DIM G(8,8),C(9,2),K(3,3),N(3),Z(8,8),D(8)\n \
370 T=INT(RND(1)*20+20)*100:T0=T:T9=25+INT(RND(1)*10):D0=0:E=3000:E0=E\n \
440 P=10:P0=P:S9=200:S=0:B9=2:K9=0:X$=\"\":X0$=\" IS \"\n \
470 DEF FND(D)=SQR((K(I,1)-S1)^2+(K(I,2)-S2)^2)\n \
475 DEF FNR(R)=INT(RND(R)*7.98+1.01)\n \
480 REM INITIALIZE ENTERPRIZE'S POSITION\n \
490 Q1=FNR(1):Q2=FNR(1):S1=FNR(1):S2=FNR(1)\n \
530 FORI=1TO9:C(I,1)=0:C(I,2)=0:NEXTI\n \
540 C(3,1)=-1:C(2,1)=-1:C(4,1)=-1:C(4,2)=-1:C(5,2)=-1:C(6,2)=-1\n \
600 C(1,2)=1:C(2,2)=1:C(6,1)=1:C(7,1)=1:C(8,1)=1:C(8,2)=1:C(9,2)=1\n \
670 FORI=1TO8:D(I)=0:NEXTI\n \
710 A1$=\"NAVSRSLRSPHATORSHEDAMCOMXXX\"\n \
810 REM SETUP WHAT EXHISTS IN GALAXY . . .\n \
815 REM K3= # KLINGONS  B3= # STARBASES  S3 = # STARS\n \
820 FORI=1TO8:FORJ=1TO8:K3=0:Z(I,J)=0:R1=RND(1)\n \
850 IFR1>.98THENK3=3:K9=K9+3:GOTO980\n \
860 IFR1>.95THENK3=2:K9=K9+2:GOTO980\n \
870 IFR1>.80THENK3=1:K9=K9+1\n \
980 B3=0:IFRND(1)>.96THENB3=1:B9=B9+1\n \
1040 G(I,J)=K3*100+B3*10+FNR(1):NEXTJ:NEXTI:IFK9>T9THENT9=K9+1\n \
1100 IFB9<>0THEN1200\n \
1150 IFG(Q1,Q2)<200THENG(Q1,Q2)=G(Q1,Q2)+120:K9=K9+1\n \
1160 B9=1:G(Q1,Q2)=G(Q1,Q2)+10:Q1=FNR(1):Q2=FNR(1)\n \
1200 K7=K9:IFB9<>1THENX$=\"S\":X0$=\" ARE \"\n \
1230 PRINT\"YOUR ORDERS ARE AS FOLLOWS:\"\n \
1240 PRINT\"     DESTROY THE\";K9;\"KLINGON WARSHIPS WHICH HAVE INVADED\"\n \
1252 PRINT\"   THE GALAXY BEFORE THEY CAN ATTACK FEDERATION HEADQUARTERS\"\n \
1260 PRINT\"   ON STARDATE\";T0+T9;\"  THIS GIVES YOU\";T9;\"DAYS.  THERE\";X0$\n \
1272 PRINT\"  \";B9;\"STARBASE\";X$;\" IN THE GALAXY FOR RESUPPLYING YOUR SHIP\"\n \
1280 PRINT:REM PRINT\"HIT ANY KEY EXCEPT RETURN WHEN READY TO ACCEPT COMMAND\"\n \
1300 I=RND(1):REM IF INP(1)=13 THEN 1300\n \
1310 REM HERE ANY TIME NEW QUADRANT ENTERED\n \
1320 Z4=Q1:Z5=Q2:K3=0:B3=0:S3=0:G5=0:D4=.5*RND(1):Z(Q1,Q2)=G(Q1,Q2)\n \
1390 IFQ1<1ORQ1>8ORQ2<1ORQ2>8THEN1600\n \
1430 GOSUB 9030:PRINT:IF T0<>T THEN 1490\n \
1460 PRINT\"YOUR MISSION BEGINS WITH YOUR STARSHIP LOCATED\"\n \
1470 PRINT\"IN THE GALACTIC QUADRANT, '\";G2$;\"'.\":GOTO 1500\n \
1490 PRINT\"NOW ENTERING \";G2$;\" QUADRANT . . .\"\n \
1500 PRINT:K3=INT(G(Q1,Q2)*.01):B3=INT(G(Q1,Q2)*.1)-10*K3\n \
1540 S3=G(Q1,Q2)-100*K3-10*B3:IFK3=0THEN1590\n \
1560 PRINT\"COMBAT AREA      CONDITION RED\":IFS>200THEN1590\n \
1580 PRINT\"   SHIELDS DANGEROUSLY LOW\"\n \
1590 FORI=1TO3:K(I,1)=0:K(I,2)=0:NEXTI\n \
1600 FORI=1TO3:K(I,3)=0:NEXTI:Q$=Z$+Z$+Z$+Z$+Z$+Z$+Z$+LEFT$(Z$,17)\n \
1660 REM POSITION ENTERPRISE IN QUADRANT, THEN PLACE \"K3\" KLINGONS, &\n \
1670 REM \"B3\" STARBASES, & \"S3\" STARS ELSEWHERE.\n \
1680 A$=\"<*>\":Z1=S1:Z2=S2:GOSUB8670:IFK3<1THEN1820\n \
1720 FORI=1TOK3:GOSUB8590:A$=\"+K+\":Z1=R1:Z2=R2\n \
1780 GOSUB8670:K(I,1)=R1:K(I,2)=R2:K(I,3)=S9*(0.5+RND(1)):NEXTI\n \
1820 IFB3<1THEN1910\n \
1880 GOSUB8590:A$=\">!<\":Z1=R1:B4=R1:Z2=R2:B5=R2:GOSUB8670\n \
1910 FORI=1TOS3:GOSUB8590:A$=\" * \":Z1=R1:Z2=R2:GOSUB8670:NEXTI\n \
1980 GOSUB6430\n \
1990 IFS+E>10THENIFE>10ORD(7)=0THEN2060\n \
2020 PRINT:PRINT\"** FATAL ERROR **   YOU'VE JUST STRANDED YOUR SHIP IN \"\n \
2030 PRINT\"SPACE\":PRINT\"YOU HAVE INSUFFICIENT MANEUVERING ENERGY,\";\n \
2040 PRINT\" AND SHIELD CONTROL\":PRINT\"IS PRESENTLY INCAPABLE OF CROSS\";\n \
2050 PRINT\"-CIRCUITING TO ENGINE ROOM!!\":GOTO6220\n \
2060 INPUT\"COMMAND\";A$\n \
2080 FORI=1TO9:IFLEFT$(A$,3)<>MID$(A1$,3*I-2,3)THEN2160\n \
2140 ONIGOTO2300,1980,4000,4260,4700,5530,5690,7290,6270\n \
2160 NEXTI:PRINT\"ENTER ONE OF THE FOLLOWING:\"\n \
2180 PRINT\"  NAV  (TO SET COURSE)\"\n \
2190 PRINT\"  SRS  (FOR SHORT RANGE SENSOR SCAN)\"\n \
2200 PRINT\"  LRS  (FOR LONG RANGE SENSOR SCAN)\"\n \
2210 PRINT\"  PHA  (TO FIRE PHASERS)\"\n \
2220 PRINT\"  TOR  (TO FIRE PHOTON TORPEDOES)\"\n \
2230 PRINT\"  SHE  (TO RAISE OR LOWER SHIELDS)\"\n \
2240 PRINT\"  DAM  (FOR DAMAGE CONTROL REPORTS)\"\n \
2250 PRINT\"  COM  (TO CALL ON LIBRARY-COMPUTER)\"\n \
2260 PRINT\"  XXX  (TO RESIGN YOUR COMMAND)\":PRINT:GOTO 1990\n \
2290 REM COURSE CONTROL BEGINS HERE\n \
2300 INPUT\"COURSE (0-9)\";C1:IFC1=9THENC1=1\n \
2310 IFC1>=1ANDC1<9THEN2350\n \
2330 PRINT\"   LT. SULU REPORTS, 'INCORRECT COURSE DATA, SIR!'\":GOTO1990\n \
2350 X$=\"8\":IFD(1)<0THENX$=\"0.2\"\n \
2360 PRINT\"WARP FACTOR (0-\";X$;\")\";:INPUTW1:IFD(1)<0ANDW1>.2THEN2470\n \
2380 IFW1>0ANDW1<=8THEN2490\n \
2390 IFW1=0THEN1990\n \
2420 PRINT\"   CHIEF ENGINEER SCOTT REPORTS 'THE ENGINES WON'T TAKE\";\n \
2430 PRINT\" WARP \";W1;\"!'\":GOTO1990\n \
2470 PRINT\"WARP ENGINES ARE DAMAGED.  MAXIUM SPEED = WARP 0.2\":GOTO1990\n \
2490 N=INT(W1*8+.5):IFE-N>=0THEN2590\n \
2500 PRINT\"ENGINEERING REPORTS   'INSUFFICIENT ENERGY AVAILABLE\"\n \
2510 PRINT\"                       FOR MANEUVERING AT WARP\";W1;\"!'\"\n \
2530 IFS<N-EORD(7)<0THEN1990\n \
2550 PRINT\"DEFLECTOR CONTROL ROOM ACKNOWLEDGES\";S;\"UNITS OF ENERGY\"\n \
2560 PRINT\"                         PRESENTLY DEPLOYED TO SHIELDS.\"\n \
2570 GOTO1990\n \
2580 REM KLINGONS MOVE/FIRE ON MOVING STARSHIP . . .\n \
2590 FORI=1TOK3:IFK(I,3)=0THEN2700\n \
2610 A$=\"   \":Z1=K(I,1):Z2=K(I,2):GOSUB8670:GOSUB8590\n \
2660 K(I,1)=Z1:K(I,2)=Z2:A$=\"+K+\":GOSUB8670\n \
2700 NEXTI:GOSUB6000:D1=0:D6=W1:IFW1>=1THEND6=1\n \
2770 FORI=1TO8:IFD(I)>=0THEN2880\n \
2790 D(I)=D(I)+D6:IFD(I)>-.1ANDD(I)<0THEND(I)=-.1:GOTO2880\n \
2800 IFD(I)<0THEN2880\n \
2810 IFD1<>1THEND1=1:PRINT\"DAMAGE CONTROL REPORT:  \";\n \
2840 PRINTTAB(8);:R1=I:GOSUB8790:PRINTG2$;\" REPAIR COMPLETED.\"\n \
2880 NEXTI:IFRND(1)>.2THEN3070\n \
2910 R1=FNR(1):IFRND(1)>=.6THEN3000\n \
2930 D(R1)=D(R1)-(RND(1)*5+1):PRINT\"DAMAGE CONTROL REPORT:  \";\n \
2960 GOSUB8790:PRINTG2$;\" DAMAGED\":PRINT:GOTO3070\n \
3000 D(R1)=D(R1)+RND(1)*3+1:PRINT\"DAMAGE CONTROL REPORT:  \";\n \
3030 GOSUB8790:PRINTG2$;\" STATE OF REPAIR IMPROVED\":PRINT\n \
3060 REM BEGIN MOVING STARSHIP\n \
3070 A$=\"   \":Z1=INT(S1):Z2=INT(S2):GOSUB8670\n \
3110 X1=C(C1,1)+(C(C1+1,1)-C(C1,1))*(C1-INT(C1)):X=S1:Y=S2\n \
3140 X2=C(C1,2)+(C(C1+1,2)-C(C1,2))*(C1-INT(C1)):Q4=Q1:Q5=Q2\n \
3170 FORI=1TON:S1=S1+X1:S2=S2+X2:IFS1<1ORS1>=9ORS2<1ORS2>=9THEN3500\n \
3240 S8=INT(S1)*24+INT(S2)*3-26:IFMID$(Q$,S8,2)=\"  \"THEN3360\n \
3320 S1=INT(S1-X1):S2=INT(S2-X2):PRINT\"WARP ENGINES SHUT DOWN AT \";\n \
3350 PRINT\"SECTOR\";S1;\",\";S2;\"DUE TO BAD NAVAGATION\":GOTO3370\n \
3360 NEXTI:S1=INT(S1):S2=INT(S2)\n \
3370 A$=\"<*>\":Z1=INT(S1):Z2=INT(S2):GOSUB8670:GOSUB3910:T8=1\n \
3430 IFW1<1THENT8=.1*INT(10*W1)\n \
3450 T=T+T8:IFT>T0+T9THEN6220\n \
3470 REM SEE IF DOCKED, THEN GET COMMAND\n \
3480 GOTO1980\n \
3490 REM EXCEEDED QUADRANT LIMITS\n \
3500 X=8*Q1+X+N*X1:Y=8*Q2+Y+N*X2:Q1=INT(X/8):Q2=INT(Y/8):S1=INT(X-Q1*8)\n \
3550 S2=INT(Y-Q2*8):IFS1=0THENQ1=Q1-1:S1=8\n \
3590 IFS2=0THENQ2=Q2-1:S2=8\n \
3620 X5=0:IFQ1<1THENX5=1:Q1=1:S1=1\n \
3670 IFQ1>8THENX5=1:Q1=8:S1=8\n \
3710 IFQ2<1THENX5=1:Q2=1:S2=1\n \
3750 IFQ2>8THENX5=1:Q2=8:S2=8\n \
3790 IFX5=0THEN3860\n \
3800 PRINT\"LT. UHURA REPORTS MESSAGE FROM STARFLEET COMMAND:\"\n \
3810 PRINT\"  'PERMISSION TO ATTEMPT CROSSING OF GALACTIC PERIMETER\"\n \
3820 PRINT\"  IS HEREBY *DENIED*.  SHUT DOWN YOUR ENGINES.'\"\n \
3830 PRINT\"CHIEF ENGINEER SCOTT REPORTS  'WARP ENGINES SHUT DOWN\"\n \
3840 PRINT\"  AT SECTOR\";S1;\",\";S2;\"OF QUADRANT\";Q1;\",\";Q2;\".'\"\n \
3850 IFT>T0+T9THEN6220\n \
3860 IF8*Q1+Q2=8*Q4+Q5THEN3370\n \
3870 T=T+1:GOSUB3910:GOTO1320\n \
3900 REM MANEUVER ENERGY S/R **\n \
3910 E=E-N-10:IFE>=0THENRETURN\n \
3930 PRINT\"SHIELD CONTROL SUPPLIES ENERGY TO COMPLETE THE MANEUVER.\"\n \
3940 S=S+E:E=0:IFS<=0THENS=0\n \
3980 RETURN\n \
3990 REM LONG RANGE SENSOR SCAN CODE\n \
4000 IFD(3)<0THENPRINT\"LONG RANGE SENSORS ARE INOPERABLE\":GOTO1990\n \
4030 PRINT\"LONG RANGE SCAN FOR QUADRANT\";Q1;\",\";Q2\n \
4040 O1$=\"-------------------\":PRINTO1$\n \
4060 FORI=Q1-1TOQ1+1:N(1)=-1:N(2)=-2:N(3)=-3:FORJ=Q2-1TOQ2+1\n \
4120 IFI>0ANDI<9ANDJ>0ANDJ<9THENN(J-Q2+2)=G(I,J):Z(I,J)=G(I,J)\n \
4180 NEXTJ:FORL=1TO3:PRINT\": \";:IFN(L)<0THENPRINT\"*** \";:GOTO4230\n \
4210 PRINTRIGHT$(STR$(N(L)+1000),3);\" \";\n \
4230 NEXTL:PRINT\":\":PRINTO1$:NEXTI:GOTO1990\n \
4250 REM PHASER CONTROL CODE BEGINS HERE\n \
4260 IFD(4)<0THENPRINT\"PHASERS INOPERATIVE\":GOTO1990\n \
4265 IFK3>0THEN4330\n \
4270 PRINT\"SCIENCE OFFICER SPOCK REPORTS  'SENSORS SHOW NO ENEMY SHIPS\"\n \
4280 PRINT\"                                IN THIS QUADRANT'\":GOTO1990\n \
4330 IFD(8)<0THENPRINT\"COMPUTER FAILURE HAMPERS ACCURACY\"\n \
4350 PRINT\"PHASERS LOCKED ON TARGET;  \";\n \
4360 PRINT\"ENERGY AVAILABLE =\";E;\"UNITS\"\n \
4370 INPUT\"NUMBER OF UNITS TO FIRE\";X:IFX<=0THEN1990\n \
4400 IFE-X<0THEN4360\n \
4410 E=E-X:IFD(7)<0THENX=X*RND(1)\n \
4450 H1=INT(X/K3):FORI=1TO3:IFK(I,3)<=0THEN4670\n \
4480 H=INT((H1/FND(0))*(RND(1)+2)):IFH>.15*K(I,3)THEN4530\n \
4500 PRINT\"SENSORS SHOW NO DAMAGE TO ENEMY AT \";K(I,1);\",\";K(I,2):GOTO4670\n \
4530 K(I,3)=K(I,3)-H:PRINTH;\"UNIT HIT ON KLINGON AT SECTOR\";K(I,1);\",\";\n \
4550 PRINTK(I,2):IFK(I,3)<=0THENPRINT\"*** KLINGON DESTROYED ***\":GOTO4580\n \
4560 PRINT\"   (SENSORS SHOW\";K(I,3);\"UNITS REMAINING)\":GOTO4670\n \
4580 K3=K3-1:K9=K9-1:Z1=K(I,1):Z2=K(I,2):A$=\"   \":GOSUB8670\n \
4650 K(I,3)=0:G(Q1,Q2)=G(Q1,Q2)-100:Z(Q1,Q2)=G(Q1,Q2):IFK9<=0THEN6370\n \
4670 NEXTI:GOSUB6000:GOTO1990\n \
4690 REM PHOTON TORPEDO CODE BEGINS HERE\n \
4700 IFP<=0THENPRINT\"ALL PHOTON TORPEDOES EXPENDED\":GOTO 1990\n \
4730 IFD(5)<0THENPRINT\"PHOTON TUBES ARE NOT OPERATIONAL\":GOTO1990\n \
4760 INPUT\"PHOTON TORPEDO COURSE (1-9)\";C1:IFC1=9THENC1=1\n \
4780 IFC1>=1ANDC1<9THEN4850\n \
4790 PRINT\"ENSIGN CHEKOV REPORTS,  'INCORRECT COURSE DATA, SIR!'\"\n \
4800 GOTO1990\n \
4850 X1=C(C1,1)+(C(C1+1,1)-C(C1,1))*(C1-INT(C1)):E=E-2:P=P-1\n \
4860 X2=C(C1,2)+(C(C1+1,2)-C(C1,2))*(C1-INT(C1)):X=S1:Y=S2\n \
4910 PRINT\"TORPEDO TRACK:\"\n \
4920 X=X+X1:Y=Y+X2:X3=INT(X+.5):Y3=INT(Y+.5)\n \
4960 IFX3<1ORX3>8ORY3<1ORY3>8THEN5490\n \
5000 PRINT\"               \";X3;\",\";Y3:A$=\"   \":Z1=X:Z2=Y:GOSUB8830\n \
5050 IFZ3<>0THEN4920\n \
5060 A$=\"+K+\":Z1=X:Z2=Y:GOSUB8830:IFZ3=0THEN5210\n \
5110 PRINT\"*** KLINGON DESTROYED ***\":K3=K3-1:K9=K9-1:IFK9<=0THEN6370\n \
5150 FORI=1TO3:IFX3=K(I,1)ANDY3=K(I,2)THEN5190\n \
5180 NEXTI:I=3\n \
5190 K(I,3)=0:GOTO5430\n \
5210 A$=\" * \":Z1=X:Z2=Y:GOSUB8830:IFZ3=0THEN5280\n \
5260 PRINT\"STAR AT\";X3;\",\";Y3;\"ABSORBED TORPEDO ENERGY.\":GOSUB6000:GOTO1990\n \
5280 A$=\">!<\":Z1=X:Z2=Y:GOSUB8830:IFZ3=0THEN4760\n \
5330 PRINT\"*** STARBASE DESTROYED ***\":B3=B3-1:B9=B9-1\n \
5360 IFB9>0ORK9>T-T0-T9THEN5400\n \
5370 PRINT\"THAT DOES IT, CAPTAIN!!  YOU ARE HEREBY RELIEVED OF COMMAND\"\n \
5380 PRINT\"AND SENTENCED TO 99 STARDATES AT HARD LABOR ON CYGNUS 12!!\"\n \
5390 GOTO 6270\n \
5400 PRINT\"STARFLEET COMMAND REVIEWING YOUR RECORD TO CONSIDER\"\n \
5410 PRINT\"COURT MARTIAL!\":D0=0\n \
5430 Z1=X:Z2=Y:A$=\"   \":GOSUB8670\n \
5470 G(Q1,Q2)=K3*100+B3*10+S3:Z(Q1,Q2)=G(Q1,Q2):GOSUB6000:GOTO1990\n \
5490 PRINT\"TORPEDO MISSED\":GOSUB6000:GOTO1990\n \
5520 REM SHIELD CONTROL\n \
5530 IFD(7)<0THENPRINT\"SHIELD CONTROL INOPERABLE\":GOTO1990\n \
5560 PRINT\"ENERGY AVAILABLE =\";E+S;:INPUT\"NUMBER OF UNITS TO SHIELDS\";X\n \
5580 IFX<0ORS=XTHENPRINT\"<SHIELDS UNCHANGED>\":GOTO1990\n \
5590 IFX<=E+STHEN5630\n \
5600 PRINT\"SHIELD CONTROL REPORTS  'THIS IS NOT THE FEDERATION TREASURY.'\"\n \
5610 PRINT\"<SHIELDS UNCHANGED>\":GOTO1990\n \
5630 E=E+S-X:S=X:PRINT\"DEFLECTOR CONTROL ROOM REPORT:\"\n \
5660 PRINT\"  'SHIELDS NOW AT\";INT(S);\"UNITS PER YOUR COMMAND.'\":GOTO1990\n \
5680 REM DAMAGE CONTROL\n \
5690 IFD(6)>=0THEN5910\n \
5700 PRINT\"DAMAGE CONTROL REPORT NOT AVAILABLE\":IFD0=0THEN1990\n \
5720 D3=0:FORI=1TO8:IFD(I)<0THEND3=D3+.1\n \
5760 NEXTI:IFD3=0THEN1990\n \
5780 PRINT:D3=D3+D4:IFD3>=1THEND3=.9\n \
5810 PRINT\"TECHNICIANS STANDING BY TO EFFECT REPAIRS TO YOUR SHIP;\"\n \
5820 PRINT\"ESTIMATED TIME TO REPAIR:\";.01*INT(100*D3);\"STARDATES\"\n \
5840 INPUT \"WILL YOU AUTHORIZE THE REPAIR ORDER (Y/N)\";A$\n \
5860 IFA$<>\"Y\"THEN 1990\n \
5870 FORI=1TO8:IFD(I)<0THEND(I)=0\n \
5890 NEXTI:T=T+D3+.1\n \
5910 PRINT:PRINT\"DEVICE             STATE OF REPAIR\":FORR1=1TO8\n \
5920 GOSUB8790:PRINTG2$;LEFT$(Z$,25-LEN(G2$));INT(D(R1)*100)*.01\n \
5950 NEXTR1:PRINT:IFD0<>0THEN5720\n \
5980 GOTO 1990\n \
5990 REM KLINGONS SHOOTING\n \
6000 IFK3<=0THENRETURN\n \
6010 IFD0<>0THENPRINT\"STARBASE SHIELDS PROTECT THE ENTERPRISE\":RETURN\n \
6040 FORI=1TO3:IFK(I,3)<=0THEN6200\n \
6060 H=INT((K(I,3)/FND(1))*(2+RND(1))):S=S-H:K(I,3)=K(I,3)/(3+RND(0))\n \
6080 PRINTH;\"UNIT HIT ON ENTERPRISE FROM SECTOR\";K(I,1);\",\";K(I,2)\n \
6090 IFS<=0THEN6240\n \
6100 PRINT\"      <SHIELDS DOWN TO\";S;\"UNITS>\":IFH<20THEN6200\n \
6120 IFRND(1)>.6ORH/S<=.02THEN6200\n \
6140 R1=FNR(1):D(R1)=D(R1)-H/S-.5*RND(1):GOSUB8790\n \
6170 PRINT\"DAMAGE CONTROL REPORTS \";G2$;\" DAMAGED BY THE HIT'\"\n \
6200 NEXTI:RETURN\n \
6210 REM END OF GAME\n \
6220 PRINT\"IT IS STARDATE\";T:GOTO 6270\n \
6240 PRINT:PRINT\"THE ENTERPRISE HAS BEEN DESTROYED.  THEN FEDERATION \";\n \
6250 PRINT\"WILL BE CONQUERED\":GOTO 6220\n \
6270 PRINT\"THERE WERE\";K9;\"KLINGON BATTLE CRUISERS LEFT AT\"\n \
6280 PRINT\"THE END OF YOUR MISSION.\"\n \
6290 PRINT:PRINT:IFB9=0THEN6360\n \
6310 PRINT\"THE FEDERATION IS IN NEED OF A NEW STARSHIP COMMANDER\"\n \
6320 PRINT\"FOR A SIMILAR MISSION -- IF THERE IS A VOLUNTEER,\"\n \
6330 INPUT\"LET HIM STEP FORWARD AND ENTER 'AYE'\";A$:IFA$=\"AYE\"THEN10\n \
6360 END\n \
6370 PRINT\"CONGRULATION, CAPTAIN!  THEN LAST KLINGON BATTLE CRUISER\"\n \
6380 PRINT\"MENACING THE FDERATION HAS BEEN DESTROYED.\":PRINT\n \
6400 PRINT\"YOUR EFFICIENCY RATING IS\";1000*(K7/(T-T0))^2:GOTO6290\n \
6420 REM SHORT RANGE SENSOR SCAN & STARTUP SUBROUTINE\n \
6430 FORI=S1-1TOS1+1:FORJ=S2-1TOS2+1\n \
6450 IFINT(I+.5)<1ORINT(I+.5)>8ORINT(J+.5)<1ORINT(J+.5)>8THEN6540\n \
6490 A$=\">!<\":Z1=I:Z2=J:GOSUB8830:IFZ3=1THEN6580\n \
6540 NEXTJ:NEXTI:D0=0:GOTO6650\n \
6580 D0=1:C$=\"DOCKED\":E=E0:P=P0\n \
6620 PRINT\"SHIELDS DROPPED FOR DOCKING PURPOSES\":S=0:GOTO6720\n \
6650 IFK3>0THENC$=\"*RED*\":GOTO6720\n \
6660 C$=\"GREEN\":IFE<E0*.1THENC$=\"YELLOW\"\n \
6720 IFD(2)>=0THEN6770\n \
6730 PRINT:PRINT\"*** SHORT RANGE SENSORS ARE OUT ***\":PRINT:RETURN\n \
6770 O1$=\"---------------------------------\":PRINTO1$:FORI=1TO8\n \
6820 FORJ=(I-1)*24+1TO(I-1)*24+22STEP3:PRINT\" \";MID$(Q$,J,3);:NEXTJ\n \
6830 ONIGOTO6850,6900,6960,7020,7070,7120,7180,7240\n \
6850 PRINT\"        STARDATE          \";INT(T*10)*.1:GOTO7260\n \
6900 PRINT\"        CONDITION          \";C$:GOTO7260\n \
6960 PRINT\"        QUADRANT          \";Q1;\",\";Q2:GOTO7260\n \
7020 PRINT\"        SECTOR            \";S1;\",\";S2:GOTO7260\n \
7070 PRINT\"        PHOTON TORPEDOES  \";INT(P):GOTO7260\n \
7120 PRINT\"        TOTAL ENERGY      \";INT(E+S):GOTO7260\n \
7180 PRINT\"        SHIELDS           \";INT(S):GOTO7260\n \
7240 PRINT\"        KLINGONS REMAINING\";INT(K9)\n \
7260 NEXTI:PRINTO1$:RETURN\n \
7280 REM LIBRARY COMPUTER CODE\n \
7290 IFD(8)<0THENPRINT\"COMPUTER DISABLED\":GOTO1990\n \
7320 INPUT\"COMPUTER ACTIVE AND AWAITING COMMAND\";A:IFA<0THEN1990\n \
7350 PRINT:H8=1:ONA+1GOTO7540,7900,8070,8500,8150,7400\n \
7360 PRINT\"FUNCTIONS AVAILABLE FROM LIBRARY-COMPUTER:\"\n \
7370 PRINT\"   0 = CUMULATIVE GALACTIC RECORD\"\n \
7372 PRINT\"   1 = STATUS REPORT\"\n \
7374 PRINT\"   2 = PHOTON TORPEDO DATA\"\n \
7376 PRINT\"   3 = STARBASE NAV DATA\"\n \
7378 PRINT\"   4 = DIRECTION/DISTANCE CALCULATOR\"\n \
7380 PRINT\"   5 = GALAXY 'REGION NAME' MAP\":PRINT:GOTO7320\n \
7390 REM SETUP TO CHANGE CUM GAL RECORD TO GALAXY MAP\n \
7400 H8=0:G5=1:PRINT\"                        THE GALAXY\":GOTO7550\n \
7530 REM CUM GALACTIC RECORD\n \
7540 REM INPUT\"DO YOU WANT A HARDCOPY? IS THE TTY ON (Y/N)\";A$\n \
7542 REM IFA$=\"Y\"THENPOKE1229,2:POKE1237,3:NULL1\n \
7543 PRINT:PRINT\"        \";\n \
7544 PRINT\"COMPUTER RECORD OF GALAXY FOR QUADRANT\";Q1;\",\";Q2\n \
7546 PRINT\n \
7550 PRINT\"       1     2     3     4     5     6     7     8\"\n \
7560 O1$=\"     ----- ----- ----- ----- ----- ----- ----- -----\"\n \
7570 PRINTO1$:FORI=1TO8:PRINTI;:IFH8=0THEN7740\n \
7630 FORJ=1TO8:PRINT\"   \";:IFZ(I,J)=0THENPRINT\"***\";:GOTO7720\n \
7700 PRINTRIGHT$(STR$(Z(I,J)+1000),3);\n \
7720 NEXTJ:GOTO7850\n \
7740 Z4=I:Z5=1:GOSUB9030:J0=INT(15-.5*LEN(G2$)):PRINTTAB(J0);G2$;\n \
7800 Z5=5:GOSUB 9030:J0=INT(39-.5*LEN(G2$)):PRINTTAB(J0);G2$;\n \
7850 PRINT:PRINTO1$:NEXTI:PRINT:GOTO1990\n \
7890 REM STATUS REPORT\n \
7900 PRINT \"   STATUS REPORT:\":X$=\"\":IFK9>1THENX$=\"S\"\n \
7940 PRINT\"KLINGON\";X$;\" LEFT: \";K9\n \
7960 PRINT\"MISSION MUST BE COMPLETED IN\";.1*INT((T0+T9-T)*10);\"STARDATES\"\n \
7970 X$=\"S\":IFB9<2THENX$=\"\":IFB9<1THEN8010\n \
7980 PRINT\"THE FEDERATION IS MAINTAINING\";B9;\"STARBASE\";X$;\" IN THE GALAXY\"\n \
7990 GOTO5690\n \
8010 PRINT\"YOUR STUPIDITY HAS LEFT YOU ON YOUR ON IN\"\n \
8020 PRINT\"  THE GALAXY -- YOU HAVE NO STARBASES LEFT!\":GOTO5690\n \
8060 REM TORPEDO, BASE NAV, D/D CALCULATOR\n \
8070 IFK3<=0THEN4270\n \
8080 X$=\"\":IFK3>1THENX$=\"S\"\n \
8090 PRINT\"FROM ENTERPRISE TO KLINGON BATTLE CRUSER\";X$\n \
8100 H8=0:FORI=1TO3:IFK(I,3)<=0THEN8480\n \
8110 W1=K(I,1):X=K(I,2)\n \
8120 C1=S1:A=S2:GOTO8220\n \
8150 PRINT\"DIRECTION/DISTANCE CALCULATOR:\"\n \
8160 PRINT\"YOU ARE AT QUADRANT \";Q1;\",\";Q2;\" SECTOR \";S1;\",\";S2\n \
8170 PRINT\"PLEASE ENTER\":INPUT\"  INITIAL COORDINATES (X,Y)\";C1,A\n \
8200 INPUT\"  FINAL COORDINATES (X,Y)\";W1,X\n \
8220 X=X-A:A=C1-W1:IFX<0THEN8350\n \
8250 IFA<0THEN8410\n \
8260 IFX>0THEN8280\n \
8270 IFA=0THENC1=5:GOTO8290\n \
8280 C1=1\n \
8290 IFABS(A)<=ABS(X)THEN8330\n \
8310 PRINT\"DIRECTION =\";C1+(((ABS(A)-ABS(X))+ABS(A))/ABS(A)):GOTO8460\n \
8330 PRINT\"DIRECTION =\";C1+(ABS(A)/ABS(X)):GOTO8460\n \
8350 IFA>0THENC1=3:GOTO8420\n \
8360 IFX<>0THENC1=5:GOTO8290\n \
8410 C1=7\n \
8420 IFABS(A)>=ABS(X)THEN8450\n \
8430 PRINT\"DIRECTION =\";C1+(((ABS(X)-ABS(A))+ABS(X))/ABS(X)):GOTO8460\n \
8450 PRINT\"DIRECTION =\";C1+(ABS(X)/ABS(A))\n \
8460 PRINT\"DISTANCE =\";SQR(X^2+A^2):IFH8=1THEN1990\n \
8480 NEXTI:GOTO1990\n \
8500 IFB3<>0THENPRINT\"FROM ENTERPRISE TO STARBASE:\":W1=B4:X=B5:GOTO8120\n \
8510 PRINT\"MR. SPOCK REPORTS,  'SENSORS SHOW NO STARBASES IN THIS\";\n \
8520 PRINT\" QUADRANT.'\":GOTO1990\n \
8580 REM FIND EMPTY PLACE IN QUADRANT (FOR THINGS)\n \
8590 R1=FNR(1):R2=FNR(1):A$=\"   \":Z1=R1:Z2=R2:GOSUB8830:IFZ3=0THEN8590\n \
8600 RETURN\n \
8660 REM INSERT IN STRING ARRAY FOR QUADRANT\n \
8670 S8=INT(Z2-.5)*3+INT(Z1-.5)*24+1\n \
8675 IF LEN(A$)<>3THEN PRINT\"ERROR\":STOP\n \
8680 IFS8=1THENQ$=A$+RIGHT$(Q$,189):RETURN\n \
8690 IFS8=190THENQ$=LEFT$(Q$,189)+A$:RETURN\n \
8700 Q$=LEFT$(Q$,S8-1)+A$+RIGHT$(Q$,190-S8):RETURN\n \
8780 REM PRINTS DEVICE NAME\n \
8790 ONR1GOTO8792,8794,8796,8798,8800,8802,8804,8806\n \
8792 G2$=\"WARP ENGINES\":RETURN\n \
8794 G2$=\"SHORT RANGE SENSORS\":RETURN\n \
8796 G2$=\"LONG RANGE SENSORS\":RETURN\n \
8798 G2$=\"PHASER CONTROL\":RETURN\n \
8800 G2$=\"PHOTON TUBES\":RETURN\n \
8802 G2$=\"DAMAGE CONTROL\":RETURN\n \
8804 G2$=\"SHIELD CONTROL\":RETURN\n \
8806 G2$=\"LIBRARY-COMPUTER\":RETURN\n \
8820 REM STRING COMPARISON IN QUADRANT ARRAY\n \
8830 Z1=INT(Z1+.5):Z2=INT(Z2+.5):S8=(Z2-1)*3+(Z1-1)*24+1:Z3=0\n \
8890 IFMID$(Q$,S8,3)<>A$THENRETURN\n \
8900 Z3=1:RETURN\n \
9010 REM QUADRANT NAME IN G2$ FROM Z4,Z5 (=Q1,Q2)\n \
9020 REM CALL WITH G5=1 TO GET REGION NAME ONLY\n \
9030 IFZ5<=4THENONZ4GOTO9040,9050,9060,9070,9080,9090,9100,9110\n \
9035 GOTO9120\n \
9040 G2$=\"ANTARES\":GOTO9210\n \
9050 G2$=\"RIGEL\":GOTO9210\n \
9060 G2$=\"PROCYON\":GOTO9210\n \
9070 G2$=\"VEGA\":GOTO9210\n \
9080 G2$=\"CANOPUS\":GOTO9210\n \
9090 G2$=\"ALTAIR\":GOTO9210\n \
9100 G2$=\"SAGITTARIUS\":GOTO9210\n \
9110 G2$=\"POLLUX\":GOTO9210\n \
9120 ONZ4GOTO9130,9140,9150,9160,9170,9180,9190,9200\n \
9130 G2$=\"SIRIUS\":GOTO9210\n \
9140 G2$=\"DENEB\":GOTO9210\n \
9150 G2$=\"CAPELLA\":GOTO9210\n \
9160 G2$=\"BETELGEUSE\":GOTO9210\n \
9170 G2$=\"ALDEBARAN\":GOTO9210\n \
9180 G2$=\"REGULUS\":GOTO9210\n \
9190 G2$=\"ARCTURUS\":GOTO9210\n \
9200 G2$=\"SPICA\"\n \
9210 IFG5<>1THENONZ5GOTO9230,9240,9250,9260,9230,9240,9250,9260\n \
9220 RETURN\n \
9230 G2$=G2$+\" I\":RETURN\n \
9240 G2$=G2$+\" II\":RETURN\n \
9250 G2$=G2$+\" III\":RETURN\n \
9260 G2$=G2$+\" IV\":RETURN\n\0\0\n\0"

};
extern bool key_ready();
extern void bus_read();
extern void init_keyboard();

void send_program(char *prog) {
  unsigned int  current_char = 0;
  char c;
  while (prog[current_char] !='\0'){
    c = prog[current_char];
    if (c=='\n')
      c='\r';
    keypress(c);		
    while(key_ready()) {
      bus_read();
    }
    current_char++;
   
    tuh_task();
    hid_app_task();
   
  }
  keypress('\r');
  keypress('r');
  keypress('u');
  keypress('n');
  keypress('\r');
  
}
   

  

